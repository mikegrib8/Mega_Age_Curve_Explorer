
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Mega Age Curve Explorer (MACE)</title>

<style>
    body {
        background-color: #121530;
        font-family: Arial, sans-serif;
        color: #E8E8F0;
        margin: 0;
        padding: 0;
    }

    #controls {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        padding: 16px;
        background-color: #1A1D3A;
        border-bottom: 2px solid #FF4F9B;
        gap: 24px;
    }

    .section {
        display: flex;
        flex-direction: column;
    }

    .section-title {
        font-size: 16px;
        color: #FF4F9B;
        margin-bottom: 4px;
    }

    .chip {
        display: inline-flex;
        align-items: center;
        padding: 6px 10px;
        margin: 3px;
        border-radius: 12px;
        background-color: #FF4F9B;
        color: #121530;
        font-weight: bold;
        cursor: pointer;
    }

    .chip .remove {
        margin-left: 6px;
        font-weight: bold;
        cursor: pointer;
    }

    .metric-chip {
        display: inline-block;
        padding: 6px 12px;
        margin: 2px;
        border-radius: 12px;
        background-color: #2A2E5A;
        color: #E8E8F0;
        cursor: pointer;
        border: 1px solid #FF4F9B;
    }

    .metric-chip.selected {
        background-color: #FF4F9B;
        color: #121530;
    }

    #plot {
        width: 100%;
        height: 700px;
    }

    input[type="text"] {
        padding: 6px;
        width: 200px;
    }

    input[type="range"] {
        width: 160px;
    }

    #player-results {
        background-color: #1A1D3A;
        padding: 6px;
        max-height: 160px;
        overflow-y: auto;
        border: 1px solid #FF4F9B;
        width: 200px;
        display: none;
        position: absolute;
        z-index: 10;
    }

    .result-item {
        padding: 6px;
        cursor: pointer;
    }

    .result-item:hover {
        background-color: #2A2E5A;
    }
</style>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>

<div id="controls">

    <div class="section" style="position: relative;">
        <div class="section-title">Player Search</div>
        <input id="player-search" type="text" placeholder="Search players...">
        <div id="player-results"></div>
    </div>

    <div class="section">
        <div class="section-title">Selected Players</div>
        <div id="selected-players"></div>
    </div>

    <div class="section">
        <div class="section-title">Metrics</div>
        <div id="metric-chips">
            <span class="metric-chip selected" data-metric="grb">GRB</span>
            <span class="metric-chip" data-metric="og">OG</span>
            <span class="metric-chip" data-metric="dg">DG</span>
        </div>
    </div>

    <div class="section">
        <div class="section-title">Smoothing</div>
        <input id="smoothing-slider" type="range" min="0" max="3" value="0">
        <span id="smooth-label">0 (Raw)</span>
    </div>

</div>

<div id="plot"></div>


<script>
fetch("fig.json")
  .then(r => r.json())
  .then(fig => {
      Plotly.newPlot("plot", fig.data, fig.layout);
  });
</script>


    

    Plotly.newPlot("plot", fig.data, fig.layout);

    let currentMetric = "grb";
    let currentSmooth = 0;
    let selectedPlayers = [];

    function updateVisibility() {
        const update = { visible: [] };
        for (let i = 0; i < fig.data.length; i++) {
            update.visible[i] = false;
        }

        selectedPlayers.forEach(player => {
            const idx = traceMap[player][currentMetric][currentSmooth];
            update.visible[idx] = true;
        });

        Plotly.update("plot", update);
    }

    function renderSelectedChips() {
        const container = document.getElementById("selected-players");
        container.innerHTML = "";

        selectedPlayers.forEach(player => {
            const chip = document.createElement("span");
            chip.className = "chip";
            chip.innerHTML = player + "<span class='remove'>Ã—</span>";

            chip.querySelector(".remove").addEventListener("click", () => {
                selectedPlayers = selectedPlayers.filter(p => p !== player);
                renderSelectedChips();
                updateVisibility();
            });

            container.appendChild(chip);
        });
    }

    function showSearchResults(query) {
        const resultsBox = document.getElementById("player-results");
        resultsBox.innerHTML = "";

        if (!query) {
            resultsBox.style.display = "none";
            return;
        }

        const matches = Object.keys(traceMap)
            .filter(p => p.toLowerCase().includes(query.toLowerCase()))
            .slice(0, 10);

        matches.forEach(player => {
            const item = document.createElement("div");
            item.className = "result-item";
            item.textContent = player;

            item.addEventListener("click", () => {
                if (selectedPlayers.length >= 5) {
                    alert("Maximum 5 players selected");
                    return;
                }

                if (!selectedPlayers.includes(player)) {
                    selectedPlayers.push(player);
                    renderSelectedChips();
                    updateVisibility();
                }

                resultsBox.style.display = "none";
                document.getElementById("player-search").value = "";
            });

            resultsBox.appendChild(item);
        });

        resultsBox.style.display = matches.length ? "block" : "none";
    }

    document.getElementById("player-search").addEventListener("input", e => {
        showSearchResults(e.target.value);
    });

    document.querySelectorAll(".metric-chip").forEach(chip => {
        chip.addEventListener("click", () => {
            document.querySelectorAll(".metric-chip").forEach(c => c.classList.remove("selected"));
            chip.classList.add("selected");

            currentMetric = chip.dataset.metric;
            updateVisibility();
        });
    });

    document.getElementById("smoothing-slider").addEventListener("input", e => {
        currentSmooth = parseInt(e.target.value);
        document.getElementById("smooth-label").innerText =
            currentSmooth + (currentSmooth === 0 ? " (Raw)" : "");
        updateVisibility();
    });
</script>

</body>
</html>


